{
  "pluginType": "DB",
  "pluginId": "postgres-plugin",
  "unpublishedAction": {
    "name": "main",
    "datasource": {
      "name": "hackathon_2022",
      "pluginId": "postgres-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "id": "hackathon_2022",
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "analyse_location",
    "actionConfiguration": {
      "timeoutInMillisecond": 10000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "with my_rank as (\n    select \n        row_number() over (order by avg(di.demand_score) desc) as row_no1\n        , avg(di.demand_score)::numeric(15,2) as avg_demand_score\n        , proj_type\n    from demand_insight di \n    group by proj_type\n    order by avg(di.demand_score) desc\n    limit 3\n),\nmy_rank2 as (\n    select \n        my_rank.row_no1\n        , row_number() over (order by my_rank.row_no1, avg(di.demand_score) desc) as row_no2\n        , avg(di.demand_score)::numeric(15,2) as avg_demand_score\n        , di.proj_type\n        , di.proj_rooms\n    from demand_insight di \n    inner join my_rank on my_rank.proj_type = di.proj_type\n    group by my_rank.row_no1, di.proj_type, di.proj_rooms\n    order by my_rank.row_no1, di.proj_type, avg(di.demand_score) desc\n),\n\ntemp1 as (\n    select \n        my_rank.row_no1\n        , my_rank.avg_demand_score\n        , count(*)\n        , tp1.proj_type \n        , percentile_cont(0) within group (order by market_price) as p_min \n        , percentile_cont(0.5) within group (order by market_price) as p_med\n        , (percentile_cont(0.5) within group (order by market_price)*1.1)::numeric(15,2) as p_med2\n        , percentile_cont(1) within group (order by market_price) as p_max \n        \n        \n        , (select json_agg(row_to_json(temp2))\n        from (select \n                my_rank2.row_no1\n                , my_rank2.row_no2\n                , my_rank2.avg_demand_score\n                , count(*)\n                , tp2.proj_type \n                , tp2.no_room\n                , percentile_cont(0) within group (order by tp2.market_price) as p_min \n                , percentile_cont(0.5) within group (order by tp2.market_price) as p_med\n                , (percentile_cont(0.5) within group (order by tp2.market_price)*1.1)::numeric(15,2) as p_med2\n                , percentile_cont(1) within group (order by tp2.market_price) as p_max \n            from trx_price as tp2\n            inner join my_rank2 \n                on my_rank2.proj_type = tp2.proj_type \n                and my_rank2.proj_rooms = tp2.no_room\n            where tp2.proj_type = tp1.proj_type \n                and tp2.radii <= {{Select2.selectedOptionValue}}\n            group by my_rank2.row_no1,my_rank2.row_no2,my_rank2.avg_demand_score, tp2.proj_type, tp2.no_room\n            order by my_rank2.row_no1,my_rank2.row_no2,my_rank2.avg_demand_score, tp2.proj_type, tp2.no_room desc\n        ) temp2\n        ) as json2\n        \n        \n    from trx_price tp1\n    inner join my_rank on my_rank.proj_type = tp1.proj_type\n    where tp1.radii <= {{Select2.selectedOptionValue}}\n    group by my_rank.row_no1, my_rank.avg_demand_score, tp1.proj_type\n    order by my_rank.row_no1, my_rank.avg_demand_score \n)\n\n select * from temp1\n",
      "selfReferencingDataPaths": [],
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ]
    },
    "executeOnLoad": true,
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [
      "Select2.selectedOptionValue"
    ],
    "userSetOnLoad": false,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": []
  },
  "id": "analyse_location_main",
  "deleted": false,
  "gitSyncId": "636b452aca94d238fcabc03e_636bfc40ca94d238fcabc079"
}